#!/bin/bash
CODEDIR="$PWD"
SERVICEDIR="$(dirname "$0")"

TARBALL=http://dist.neo4j.org/neo4j-community-1.5.M02-unix.tar.gz
DIRECTORY=neo4j-community-1.5.M02

cd
if [ -d "$DIRECTORY" ]
then
    echo "Neo4j found. Skipping install phase."
else
    echo "Neo4j not found. Installing it..."
    curl "$TARBALL" | tar -zxf-
fi

echo "Generating dotCloud scaffolding..."
cat >run <<EOF
#!/bin/bash
sed -i 's/^org.neo4j.server.webserver.port=.*//' $DIRECTORY/conf/neo4j-server.properties
sed -i 's/^org.neo4j.server.webserver.address=.*//' $DIRECTORY/conf/neo4j-server.properties
echo org.neo4j.server.webserver.port=$PORT_WWW >> $DIRECTORY/conf/neo4j-server.properties
echo org.neo4j.server.webserver.address=0.0.0.0 >> $DIRECTORY/conf/neo4j-server.properties

# Alright, this is downright ugly, but it (should) work.
exec /usr/bin/java -cp /home/dotcloud/neo4j-community-1.5.M02/lib/geronimo-jta_1.1_spec-1.1.1.jar:/home/dotcloud/neo4j-community-1.5.M02/lib/lucene-core-3.1.0.jar:/home/dotcloud/neo4j-community-1.5.M02/lib/neo4j-community-1.5.M02.jar:/home/dotcloud/neo4j-community-1.5.M02/lib/neo4j-cypher-1.5.M02.jar:/home/dotcloud/neo4j-community-1.5.M02/lib/neo4j-graph-algo-1.5.M02.jar:/home/dotcloud/neo4j-community-1.5.M02/lib/neo4j-graph-matching-1.5.M02.jar:/home/dotcloud/neo4j-community-1.5.M02/lib/neo4j-jmx-1.5.M02.jar:/home/dotcloud/neo4j-community-1.5.M02/lib/neo4j-kernel-1.5.M02.jar:/home/dotcloud/neo4j-community-1.5.M02/lib/neo4j-lucene-index-1.5.M02.jar:/home/dotcloud/neo4j-community-1.5.M02/lib/neo4j-shell-1.5.M02.jar:/home/dotcloud/neo4j-community-1.5.M02/lib/neo4j-udc-1.5.M02.jar:/home/dotcloud/neo4j-community-1.5.M02/lib/org.apache.servicemix.bundles.jline-0.9.94_1.jar:/home/dotcloud/neo4j-community-1.5.M02/lib/scala-library-2.9.0-1.jar:/home/dotcloud/neo4j-community-1.5.M02/lib/server-api-1.5.M02.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/antlr-2.7.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/asm-3.1.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/asm-analysis-3.2.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/asm-commons-3.2.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/asm-tree-3.2.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/asm-util-3.2.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/avalon-framework-api-4.3.1.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/avalon-framework-impl-4.3.1.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/batik-anim-1.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/batik-awt-util-1.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/batik-bridge-1.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/batik-css-1.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/batik-dom-1.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/batik-ext-1.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/batik-extension-1.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/batik-gvt-1.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/batik-parser-1.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/batik-script-1.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/batik-svg-dom-1.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/batik-svggen-1.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/batik-transcoder-1.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/batik-util-1.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/batik-xml-1.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/blueprints-core-1.0.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/blueprints-neo4j-graph-1.0.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/commons-beanutils-1.8.0.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/commons-beanutils-core-1.8.0.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/commons-collections-3.2.1.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/commons-configuration-1.6.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/commons-digester-1.8.1.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/commons-io-1.4.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/commons-lang-2.4.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/commons-logging-1.1.1.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/fop-1.0.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/gremlin-1.3.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/groovy-1.8.2.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/jackson-core-asl-1.8.3.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/jackson-jaxrs-1.8.3.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/jackson-mapper-asl-1.8.3.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/jansi-1.5.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/jcl-over-slf4j-1.6.1.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/jersey-core-1.9.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/jersey-multipart-1.9.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/jersey-server-1.9.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/jettison-1.3.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/jetty-6.1.25.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/jetty-util-6.1.25.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/jsr311-api-1.1.1.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/log4j-over-slf4j-1.6.1.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/mimepull-1.6.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/neo4j-cypher-plugin-1.5.M02.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/neo4j-gremlin-plugin-1.5.M02.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/neo4j-server-1.5.M02.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/neo4j-server-1.5.M02-static-web.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/pipes-0.8.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/rrd4j-2.0.7.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/servlet-api-2.5-20081211.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/slf4j-api-1.6.1.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/slf4j-jdk14-1.6.1.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/stax-api-1.0.1.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/xalan-2.6.0.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/xml-apis-1.3.04.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/xml-apis-ext-1.3.04.jar:/home/dotcloud/neo4j-community-1.5.M02/system/lib/xmlgraphics-commons-1.4.jar -server -XX:+DisableExplicitGC -Dorg.neo4j.server.properties=conf/neo4j-server.properties -Djava.util.logging.config.file=conf/logging.properties -Xms3m -Xmx64m -Dlog4j.configuration=file:conf/log4j.properties -Dorg.neo4j.server.properties=/home/dotcloud/neo4j-community-1.5.M02/conf/neo4j-server.properties -Djava.util.logging.config.file=/home/dotcloud/neo4j-community-1.5.M02/conf/logging.properties -Dneo4j.home=/home/dotcloud/neo4j-community-1.5.M02 -Dneo4j.instance=/home/dotcloud/neo4j-community-1.5.M02 org.neo4j.server.Bootstrapper
EOF
chmod +x run
